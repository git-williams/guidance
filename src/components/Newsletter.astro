---
// src/components/Newsletter.astro
---
<section class="newsletter-section">
  <div class="newsletter-container">
    <!-- Left Side: Title, Description, Nav Buttons -->
    <div class="newsletter-left">
      <h1 class="newsletter-title">Find Beauty in<br />the Details</h1>
      <p class="newsletter-description">
        Subscribe for rare insights, original ideas, and distilled content. No fluff. Just the signal.
      </p>

      <div class="newsletter-buttons">
        <a href="/about" class="newsletter-link-button">Read the Blog</a>
        <a href="/blog" class="newsletter-link-button">Contact Me</a>
        <a href="/resources" class="newsletter-link-button">Learn More</a>
      </div>
    </div>

    <!-- Right Side: Form -->
    <div class="newsletter-right">
      <form id="newsletterForm" class="newsletter-form" novalidate>
        <div class="success-message-container">
          <p class="form-message" id="formMessage" aria-live="polite" aria-atomic="true" role="alert"></p>
        </div>
        <input
          type="email"
          id="emailInput"
          placeholder="Enter your email"
          autocomplete="email"
          required
        />
        <button type="submit" class="submit-button">Start Reading</button>
        <input
          type="text"
          name="website"
          id="website"
          style="display: none"
          tabindex="-1"
          autocomplete="off"
        />
      </form>
    </div>
  </div>
</section>

<!-- Inline Script Block -->
<script is:inline>
  // Disable hover effects on touch devices
  if ('ontouchstart' in window || navigator.maxTouchPoints > 0) {
    document.body.classList.add('no-hover');
  }

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('newsletterForm');
    const input = document.getElementById('emailInput');
    const message = document.getElementById('formMessage');
    const honeypot = document.getElementById('website');
    const button = form.querySelector('button[type="submit"]');

    function showMessage(text, color) {
      message.textContent = text;
      message.style.color = color;

      message.classList.remove('show', 'hide');
      void message.offsetWidth;
      message.classList.add('show');

      setTimeout(() => {
        message.classList.remove('show');
        message.classList.add('hide');
      }, 3000);

      setTimeout(() => {
        message.classList.remove('hide');
        message.textContent = '';
      }, 3400);
    }

    function updatePlaceholder() {
      if (window.innerWidth <= 768) {
        input.placeholder = 'Email';
      } else {
        input.placeholder = 'Enter your email';
      }
    }

    updatePlaceholder(); // Run on load
    window.addEventListener('resize', updatePlaceholder); // Run on resize

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Basic bot check
      if (honeypot.value !== '') return;

      const email = input.value.trim();
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (email === '') {
        showMessage('Email is required.', '#ff6666');
        return;
      }

      if (!emailRegex.test(email)) {
        showMessage('Please enter a valid email.', '#ff6666');
        return;
      }

      button.disabled = true;

      try {
        const res = await fetch('https://formspree.io/f/mgvkqowp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email }),
        });

        if (res.ok) {
          showMessage("Thanks! You're on the list.", '#66ff99');
          input.value = '';
        } else {
          showMessage('Something went wrong. Please try again.', '#ff6666');
        }
      } catch (err) {
        showMessage('Network error. Try again later.', '#ff6666');
      } finally {
        button.disabled = false;
      }
    });
  });
</script>
